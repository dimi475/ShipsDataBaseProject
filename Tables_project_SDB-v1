 /*OD_NAVY user SQL code for tables creation.
User OD_NAVY is basic one with privileges to see all the tables*/
 
 /*start tables*/
 
 CREATE TABLE OWNER_DATA (
 SHIP_OWNER VARCHAR(45),
 OWNER_WEB_SITE VARCHAR(45),
 OWNER_ADRESS VARCHAR(45),
 OWNER_TELEPHONE INT,
 OWNER_FAX INT,
 CONSTRAINT owner_data_pk PRIMARY KEY (SHIP_OWNER));
 
 CREATE TABLE CHARTERER_DATA (
 SHIP_CHARTERER VARCHAR(45),
 CHARTERER_WEB_SITE VARCHAR(45),
 CHARTERER_ADRESS VARCHAR(45),
 CHARTERER_TELEPHONE INT,
 CHARTERER_FAX INT,
 CONSTRAINT charterer_data_pk PRIMARY KEY (SHIP_CHARTERER));
 
 create table SHIP_DATA (
 SHIP_NAME VARCHAR(45),
 IMO_NUM INT,
 MMSI_NUM INT,
 FLAG VARCHAR(45),
 YEAR_OF_BUILD INT,
 LENGHT VARCHAR(10),
 BEAM VARCHAR(10),
 DRAFT_BOW VARCHAR(10),
 DRAFT_ASTERN VARCHAR(10),
 HEIGHT_over_WATERLINE VARCHAR(10),
 DISPLACEMENT VARCHAR(20),
 SPEED INT,
 SHIP_TYPE VARCHAR(10),
 CREW INT,
 SHIP_MASTER VARCHAR(45),
 SHIP_OWNER VARCHAR(45),
 SHIP_OLD_NAMES VARCHAR(45),
 CONSTRAINT ship_data_pk primary key (SHIP_NAME),
 CONSTRAINT ship_owner_fk FOREIGN KEY (SHIP_OWNER) REFERENCES OWNER_DATA (SHIP_OWNER));
 
 CREATE TABLE SITES (
 SITE_NUM VARCHAR(15),
 SITES VARCHAR(45),
 CONSTRAINT site_num_pk PRIMARY KEY (SITE_NUM));
 
 CREATE TABLE RADARS (
 RADAR_NUMBER VARCHAR(12),
 SITE_NUM VARCHAR(15),
 RADARS VARCHAR(20),
 CONSTRAINT radar_num_pk PRIMARY KEY (RADAR_NUMBER),
 CONSTRAINT radar_site_fk FOREIGN KEY (SITE_NUM) REFERENCES SITES (SITE_NUM));
 
 CREATE TABLE AIS_BS (
 AIS_NUMBER VARCHAR(12),
 SITE_NUM VARCHAR(15),
 AIS_Bs VARCHAR(20),
 CONSTRAINT ais_num_pk PRIMARY KEY (AIS_NUMBER),
 CONSTRAINT ais_site_fk FOREIGN KEY (SITE_NUM) REFERENCES SITES (SITE_NUM));
 
 CREATE TABLE CCTVs (
 VIDEO_NUMBER VARCHAR(12),
 SITE_NUM VARCHAR(15),
 CCTV VARCHAR(20),
 CONSTRAINT video_num_pk PRIMARY KEY (VIDEO_NUMBER),
 CONSTRAINT video_site_fk FOREIGN KEY (SITE_NUM) REFERENCES SITES (SITE_NUM));
 
 CREATE TABLE M2Ms (
 M2M_NUMBER VARCHAR(12),
 SITE_NUM VARCHAR(15),
 PLATFORM_DATA VARCHAR(20),
 CONSTRAINT m2m_num_pk PRIMARY KEY (M2M_NUMBER),
 CONSTRAINT m2m_site_fk FOREIGN KEY (SITE_NUM) REFERENCES SITES (SITE_NUM));
 
  CREATE TABLE TRACK_DATA (
 TRACK_NUMBER VARCHAR(45),
 TRACK_TIME TIMESTAMP(6) WITH TIME ZONE,
 RADAR_NUMBER VARCHAR(12),
 AIS_NUMBER VARCHAR(12),
 VIDEO_NUMBER VARCHAR(12),
 M2M_NUMBER VARCHAR(12),
 POSITION_LAT VARCHAR(15),
 POSITION_LON VARCHAR(15),
 COG DECIMAL,
 SOG DECIMAL,
 LPC VARCHAR(45),
 NPC VARCHAR(45),
 ETA TIMESTAMP(6) WITH TIME ZONE,
 CARGO VARCHAR(45),
 CONSTRAINT track_data_pk PRIMARY KEY (TRACK_NUMBER),
 CONSTRAINT track_radar_num_fk foreign key (RADAR_NUMBER)REFERENCES RADARS (RADAR_NUMBER), 
 CONSTRAINT track_ais_num_fk foreign key (AIS_NUMBER)REFERENCES AIS_BS (AIS_NUMBER), 
 CONSTRAINT track_cctv_num_fk foreign key (VIDEO_NUMBER)REFERENCES CCTVs (VIDEO_NUMBER),
 CONSTRAINT track_m2m_num_fk foreign key (M2M_NUMBER)REFERENCES M2Ms (M2M_NUMBER));
 
 CREATE TABLE COI (
 Is_COI VARCHAR(10),
 TRACK_NUMBER VARCHAR(45),
 TRACK_CLASSIFICATION VARCHAR(20),
 CONSTRAINT isCoi_num_pk PRIMARY KEY (Is_COI),
 CONSTRAINT isCoi_site_fk FOREIGN KEY (TRACK_NUMBER) REFERENCES TRACK_DATA (TRACK_NUMBER));
 
 /* hash table */
 
 create table assoc_table (
 TABLE_NUM VARCHAR(15),
 SHIP_NAME VARCHAR(45),
 TRACK_NUMBER VARCHAR(45),
 SHIP_CHARTERER VARCHAR(45),
 CONSTRAINT assoc_table_pk PRIMARY KEY (TABLE_NUM),
 CONSTRAINT assoc_table_name_fk FOREIGN KEY (SHIP_NAME) REFERENCES SHIP_DATA(SHIP_NAME),
 CONSTRAINT asoc_table_num_fk FOREIGN KEY (TRACK_NUMBER) REFERENCES TRACK_DATA(TRACK_NUMBER),
 CONSTRAINT asoc_table_chart_fk FOREIGN KEY (SHIP_CHARTERER) REFERENCES CHARTERER_DATA(SHIP_CHARTERER));
 
GRANT SELECT ON SHIP_DATA TO OD_BPOLICE;
GRANT SELECT ON SHIP_DATA TO VTS_Capitan;

GRANT SELECT ON TRACK_DATA TO OD_BPOLICE;
GRANT SELECT ON TRACK_DATA TO VTS_Capitan;
 
 
 /* User OD_BPOLICE SQL commands. This user have no permition to see all data from the sensors, plus table restricted view for table Is_COI. */
 
 CREATE TABLE SHIP_DATA 
 PARALLEL AS
 SELECT * FROM OD_NAVY.SHIP_DATA;

 CREATE TABLE TRACK_DATA 
 PARALLEL AS 
 SELECT *
 FROM OD_NAVY.TRACK_DATA;
 
 
CREATE VIEW SHIP_DATA_POLICE AS 
SELECT 
 E.SHIP_NAME,
 E.IMO_NUM,
 E.MMSI_NUM,
 E.FLAG,
 E.YEAR_OF_BUILD,
 E.DISPLACEMENT,
 E.SPEED,
 E.SHIP_TYPE,
 E.CREW,
 E.SHIP_MASTER,
 E.SHIP_OWNER,
 E.SHIP_OLD_NAMES
 FROM SHIP_DATA E
 WHERE
 E.SHIP_NAME=D.SHIP_NAME;
 
 CREATE VIEW TRACK_DATA_POLICE AS 
 SELECT 
 D.TRACK_NUMBER,
 D.TRACK_TIME,
 D.POSITION_LAT,
 D.POSITION_LON,
 D.COG,
 D.SOG,
 D.LPC,
 D.NPC,
 D.ETA,
 D.CARGO
 FROM TRACK_DATA D
 WHERE 
 D.TRACK_NUMBER=TRACK_NUMBER;	
 
 /* User VTS_Capitan SQL commands. This user have no permition to see all data from the sensors, plus table table Is_COI. */
 
CREATE TABLE SHIP_DATA 
 PARALLEL AS
 SELECT * FROM OD_NAVY.SHIP_DATA;

 CREATE TABLE TRACK_DATA 
 PARALLEL AS 
 SELECT *
 FROM OD_NAVY.TRACK_DATA;
 
 
CREATE VIEW SHIP_DATA_VTS_VIEW AS 
SELECT 
 E.SHIP_NAME,
 E.IMO_NUM,
 E.MMSI_NUM,
 E.FLAG,
 E.YEAR_OF_BUILD,
 E.LENGHT,
 E.BEAM,
 E.DRAFT_BOW,
 E.DRAFT_ASTERN,
 E.HEIGHT_over_WATERLINE,
 E.DISPLACEMENT,
 E.SPEED,
 E.SHIP_TYPE,
 E.CREW,
 E.SHIP_MASTER,
 E.SHIP_OWNER,
 E.SHIP_OLD_NAMES
 FROM SHIP_DATA E
 WHERE 
 E.SHIP_NAME=SHIP_NAME;
 
 CREATE VIEW TRACK_DATA_VTS_VIEW AS 
SELECT
 D.TRACK_NUMBER,
 D.TRACK_TIME,
 D.POSITION_LAT,
 D.POSITION_LON,
 D.COG,
 D.SOG,
 D.LPC,
 D.NPC,
 D.ETA,
 D.CARGO
 FROM TRACK_DATA D
 WHERE
 D.TRACK_NUMBER=TRACK_NUMBER;	
 
